// Generated by CoffeeScript 1.6.2
exports.connect = function(cn, callback) {
  var client, net;

  global.clientAnswer = '';
  net = global.controls.lib.net.init();
  client = net.connect(cn.connect.port, cn.connect.ip);
  if (callback) {
    return callback(client);
  }
};

exports.getAllMessages = function(client, cn, callback) {
  var colors;

  colors = global.controls.lib.colors.init();
  client.write(cn.connect.login + '\n');
  client.write(cn.connect.password + '\n');
  client.write('en' + '\n');
  client.write(cn.commands.getAllMessages.cmd + '\n');
  client.write('exit' + '\n');
  client.write('exit' + '\n');
  client.on('data', function(data) {
    return global.clientAnswer += data.toString();
  });
  client.on('error', function(err) {
    return console.log('telnet:'.error, err.message.data);
  });
  return client.on('close', function() {
    var ms;

    if (global.clientAnswer !== '') {
      if (global.program.debug) {
        console.log(global.clientAnswer.data);
      }
      ms = global.controls.parser.snParseMessages(global.clientAnswer);
      if (parseInt(ms.length) > 0) {
        console.log('client:'.info, parseInt(ms.length).toString().data, 'new sms'.data);
        if (callback) {
          return callback(ms);
        }
      } else {
        return console.log('client:'.warn, parseInt(ms.length).toString().data, 'new sms'.data);
      }
    } else {
      return console.log('telnet:'.error, 'data not found'.data);
    }
  });
};

exports.insertMessageIntoBase = function(data, cn, db, callback) {
  return global.controls.db.query(global.controls.sql.sms.insertMessageIntoBase(data, cn), db, function(result) {
    if (callback) {
      return callback(result);
    }
  });
};

exports.rmAllMessages = function(client, cn, callback) {
  var colors;

  colors = global.controls.lib.colors.init();
  client.write(cn.connect.login + '\n');
  client.write(cn.connect.password + '\n');
  client.write('en' + '\n');
  client.write(cn.commands.rmAllMessages.cmd + '\n');
  client.write('exit' + '\n');
  client.write('exit' + '\n');
  return client.on('close', function() {
    if (callback) {
      return callback();
    }
  });
};
